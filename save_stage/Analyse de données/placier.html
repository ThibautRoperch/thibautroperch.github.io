<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Ville</title>
    <link rel="stylesheet" type="text/css" href="css/style.css">
</head>

<body>

    <content>
        <aside>
            <div>
                <nav class="modules">
                    <a class="active" href="placier.html">Placier</a>
                    <a href="tlpe.html">TLPE</a>
                </nav>
                <nav>
                    <a href="#factures">Factures</a>
                    <a href="#marches">Marchés</a>
                </nav>
            </div>
        </aside>
    
        <section id="factures">
            Chargement des factures
        </section>
    
        <section id="marches">
            Chargement des marchés
        </section>
    </content>

    <footer>zad</footer>
    
</body>

</html>

<script src="js/ajax.js"></script>
<script src="js/moment.js"></script>
<script src="js/Chart.js"></script>
<script>

var ville = document.location.search.substr(1).toLowerCase();

// Titre de la page
document.querySelector("title").innerHTML = ville.toUpperCase();

// Factures
var factures_dom = document.querySelector("#factures");
ajax("http://localhost:8080/analyse_donnees/factures.php?ville=" + ville, handle_factures, null);

// Marchés
var marches_om = document.querySelector("#marches");
ajax("http://localhost:8080/analyse_donnees/marches.php?ville=" + ville, handle_marches, null);

function handle_factures(json) {
    var json = JSON.parse(json);

    // Evolution des revenus

    var graphique = document.createElement("canvas");
    factures_dom.appendChild(graphique);

    var annees = [];
    var revenus = [];
    for (annee in json.records) {
        annees.push(annee);
        revenus.push(json.records[annee].total_ttc);
    }

    var ctx = graphique.getContext('2d');
    var cfg = {
        type: 'bar',
        data: {
            labels: annees,
            datasets: [
                {
                    label: 'revenus',
                    data: revenus,
                    type: 'line',
                    pointRadius: 0,
                    fill: true,
                    lineTension: 0,
                    borderWidth: 2,
                    // backgroundColor: "red",
                    // borderColor: "red"
                }
            ]
        },
        options: {
            title: {
                display: true,
                text: 'Revenus en foncion des années'
            },
            legend: {
                display: false
            },
            tooltips: {
                mode: 'nearest',
                intersect: true
            },
            scales: {
                xAxes: [{
                    type: 'time',
                    distribution: 'series',
                    ticks: {
                        source: 'labels'
                    }
                }],
                yAxes: [{
                    stacked: true,
                    scaleLabel: {
                        display: true,
                        labelString: 'Revenus (€)',
                        min: 0
                    }
                }]
            }
        }
    };
    var chart = new Chart(ctx, cfg);
}

function handle_marches(json) {
    var json = JSON.parse(json);


}

</script>
